import xml.etree.ElementTree as ET
from svg_code import *


def get_allDNA(Tag_DNAseqlist):
    # 传入编码得到的DNAseq的list 返回解码得到各个
    allDNA = []
    for i in Tag_DNAseqlist:
        allDNA.append(decode_tag(i))
    return allDNA


def generate_SVGtag(tag_list):
    tag_name = tag_list[0]
    line = '<{}'.format(tag_name)
    text_val = ''
    for attr in tag_list[4:]:
        if attr[0] != 'text':
            line += ' {} = "{}"'.format(attr[0], attr[1])
        else:
            text_val = attr[1]
    if tag_name == 'svg':
        line += ' xmlns="http://www.w3.org/2000/svg"'
    line += '>{}</{}>'.format(text_val, tag_name)
    return line


def add_child(root, tag_name, child):
    idx = -1*len(tag_name)-3
    line = '\n'.join([root[:idx], child])
    line += '\n'+root[idx:]
    return line
# 将并列的后一个标签写入


def add_bro(root, bro):
    line = '\n'.join([root, bro])
    return line


def dfs_add(allDNA, cur=0):
    # 将各个标签拼接
    first_child = int(allDNA[cur][2])
    bro = int(allDNA[cur][3])
    cur_tag_name = allDNA[cur][0]

    if first_child == -1:
        if bro == -1:
            return generate_SVGtag(allDNA[cur])
        else:
            return add_bro(generate_SVGtag(allDNA[cur]), dfs_add(allDNA, bro))
    else:
        leaf = add_child(generate_SVGtag(
            allDNA[cur]), cur_tag_name, dfs_add(allDNA, first_child))
        if bro == -1:
            return leaf
        else:
            return add_bro(leaf, dfs_add(allDNA, bro))


def generate_svg(DNAseq):
    # 传入各个标签及参数的DNA序列list
    allDNA = get_allDNA(DNAseq)  # 将DNAseq转化成各个标签及参数
    allDNA = sorted(allDNA, key=lambda x: int(x[1]))
    file = '<?xml version="1.0" ?>'
    file += dfs_add(allDNA)
    return file


if __name__ == '__main__':
    # test1
    seq = ['GGTATGAATAAATTTATTATCACTACTAAATAAATAATCTAAAAAATCTAAAAATAGATTAGAT', 'TGTATGAATTAAGTCGAATCATA', 'TTTATGAAGTCGTATTTATTGTAGTAAACGCTCAGTCGATGAGACGTAGATTGCGTCTCTCCTTCGATCGAAGCCACAGTCAGAGATTCTCAGCATCTCAGTAAGCGTGGTACGCTCAGTCGATGAGACGTAGACTGCGTCTCTCCTTCGATCGAAGCCACAGAGTTTCTTTCATAGTTAGTTTCAGAGCGTGGTACGCTCAGTCGATGAGACGTAGAGTGCGTCTCTCCTTCGATCGAAGCCACAGTCTCTCTCTCTCAGCGTGGTACGCTCAGTCGATGAGACGTAGTATGCGTCTCTCCTTCGATCGAAGCCACAGAGAAAGTTTCAGTCTATCTCTCTCAGCGTGGTACGCTCAGTCGATGAGACGTAGTTTGCGTCTCTCCTTCGATCGAAGCCACAGAGTCTCTTTCTTAGATTCTCTCTCAGCGTGGTACGCTCAGTCGATGAGACGTAGTCTGCGTCTCTCCTTCGATCGAAGCCACAGAGAAAGAATCATTCTCTCTCAGTAAGCGTGGTACGCTCAGTCGATGAGACGTAGTGTGCGTCTCTCCTTCGATCGAAGCCACAGTCATTCATTCTAAGTTAGTAAGAAAGCGTGGTACGCTCAGTCGATGAGACGTAGCATGCGTCTCTCCTTCGATCGAAGCCACAGAGTTAGACAGAGAGCAAGAGAGCAAGCGTGGTACGCTCAGTCGATGAGACGTAGCTTGCGTCTCTCCTTCGATCGAAGCCACAGAGCATCACTCAGAGCAAGTTAGACAGCGTGGTACGCTCAGTCGATGAGACGTAGATAGAATGCGTCTCTCCTTCGATCGAAGCCACAGAGTCAGTCAGTAAGTTAGTAAGTTAGCGTGGTATA', 'AATATGAATCTATTAATGACTAAGGGTCCAAGGTTGACTATAAATCAAGAACCTACTAAGGATAACGGTTGAATTTTGACTTTCAGTCGATGAGACGTAGAT', 'ACTATGAATGTATTAACTAGTAGGCATAGTAGCAAGTCAGCTACGCAGACAGTGACGAAGTAAGACAGTAACGCAGTTAGCATCGAACGTAGATAGTAAGTTACGCAGATAGCTACGTAGTTAGTGTCATAGCAAGTGACGCAGTAACGAAGCAAGTGACGCAGTAACGAAGAAACGAAGAAACGAAGATACGTAGACACGCAGATACGAAGTCAGTGACGCAGTGAGATTCCAAGAATCATAGCAAGTGACGCAGTGAGACACGAAGCAAGTGACGCAGTGAGACACGAAGAAACGAAGAAACGAAGATACGTAGATAGATAGTCACGCAGACACGAAGTAAGAGACGCAGTAAGTCTCGAACGTAGACAGTCAGCTACGCAGCTAGTAACGTAGATAGACAGAGTCATAGCAAGTGACGCAGTGAGACACGAAGCAAGTGACGCAGTGAGACACGAAGAAACGAAGAAACGAAGATACGTAGTAAGAGACGCAGTAAGTTACGTAGATAGATAGTCACGCAGACTCCAAGAATCATAGCAAGTGACGCAGAGAGTTACGAAGCAAGTGACGCAGAGAGTTACGAAGAAACGAAGAAACGAAGATACGAAGACAGTAACGCAGTCAGCTACGTAGAGAGATACGCAGCAAGTCTCGAACGTAGACAGAGACGCAGTCAGCAACGTAGCTACGCAGAGTCAGACGTAGATAGATAGAAACGAAGTCAGTTACGCAGATAGTTACGTAGATAGCAAGTTACGCAGTAAGCAACGAAGATAGCAAGACACGCAGTAAGCTACGTAGATAGCTAGACACGCAGACAGTTACGAAGAGAGATAGTGACGCAGCTAGTATACAAGCAAGCAAGTAACGCAGCTTAATAGAGAGCTAGAAACGCAGCTAGACACGAAGAGAGCTAGAAACGCAGCTAGACACGAAGAAACGAAGAAACGAAGAAACGAAGCAAGTCAGCTACGCAGACAGTGACGAAGTAAGACAGTAACGCAGTTAGCATTCCATTTTGACTTTCAGTCGATGAGACGTAGAC', 'AATATGAACTATATTAACTTACTATAATCTTCAGGTTGACTAAGCTACCCACCAGGACTAACCCACTCATTACAATTTTGACTTTCAGTCGATGAGACGTAGAG', 'AATATGAACTTTATTAACTCACTATAAGCTTTGGTTGAACTAAGCCTTATAACCTAACTAACCCACTCATTACAATTTTGACTTTCAGTCGATGAGACGTAGAG', 'ACTATGAACTCTATTAACTGGTACATGTAGTAGATAGATAGTCACGCAGTCAGCTACGAAGTAAGACAGTAACGCAGCAAGCTTCATAGAGAGCTAGACACGCAGAGAGTTACGAAGAGAGCTAGACACGCAGAGAGTTACGAAGAAACGAAGAAACGAAGAAACGTAGATAGTCACGAAGATAGATAGATACGCAGAGTCAGAGAAACGAAGACAGATAGTCACGCAGTGACGAAGATAGTGAGTTACGCAGTCAGTGACGAAGAGAGCTAGACACGCAGAGAGTGACGAAGAGAGCTAGACACGCAGAGAGCAACGAAGAGAGCTAGACACGCAGAGAGTGTTAGAGCAAGCAAGTTACGCAGTAACGAAGTGAGTTAGACACGCAGCAAGCTACGAAGCAAGCAAGTTACGCAGTAACGAAGTTAGAGAGTCACGCAGATAGCTTCATAGAGAGCTAGACACGCAGAGAGTTACGAAGAGAGCTAGACACGCAGAGAGTTACGAAGAAACGAAGAAACGAAGAAACGTAGATAGTCACGTAGATAGATAGATACGCAGAGTTCCATTTTGACTTTCAGTCGATGAGACGTAGTA', 'TCTATGAACTGTATTAACCAACTAACATTAATTATGCGACTAAGCATCCCGCATTAACTATATATATATGCCGCACTAAGGGACATAGAGAGATTTTGACTTTCAGTCGATGAGACGTAGTT', 'TATATGAACCATATTAACCTACTAACAGGGTTATGCGAACTATAAATATGAAAAAAACTAAGCCACGCAAAAAAACTATAACACCCGTTGATATTTTGACTTTCAGTCGATGAGACGTAGTC', 'ACTATGAACCTTATTAACCCGTATTTCTAGTAGTCAGCAAGCAACGCAGTAAGTAACGAAGTTAGACAGTTACGCAGTGAGAGTCGAAGATACGCAGCAAGCAACGCAGCTAGAGACGAAGATAGATAGAAACGCAGTAAGCTACGTAGATAGATACGCAGTTAGTTACGTAGTCAGCTAGTGACGTAGACAGCAACGCAGTAAGCATCATAGAGAGCTAGTTACGCAGACAGCAACGAAGAGAGCTAGTTACGCAGACAGCAACGAAGAAACGAAGAAACGAAGAAACGAACGCAGACAGCAACGAAGATAGAAAGATACGCAGAGTCGAAGTTAGCAAGAGACGCAGTTAGTGACGTAGTCAGATTTCCATTTTGACTTTCAGTCGATGAGACGTAGTC', 'ACTATGAACCCTATTAACCGGTACTGATAGTAGCAAGTGAGATACGCAGACAGTTACGAAGTCAGTAAGAAACGCAGCTTCAGACGTAGCTAGTAACGCAGAGAGCTACGTAGACACGCAGTCAGACACGTAGATAGCTAGTCACGCAGTTAGCAACGAAGACAGTGACGTAGACAGCAAGTGACGCAGACAGAGACGAAGCTAGAAACGCAGACAGATTAAGAGTTAGAAAGCTACGCAGTGACGAAGTGAGCAAGAGACGAAGTAAGTTAGTAACGAAGCAAGTAAGCTACGCAGCTAGAGACGAAGTAAGATAGCTACGCAGTCAGCTACGAAGCTAGACAGATACGCAGTCAGCTTAATAGAGAGCTAGTAACGCAGTCAGTTACGAAGAGAGCTAGTAACGCAGTCAGTTACGAAGAAACGAAGAAACGAAGAAACGAAGTAAGCTAGAGACGAAGCTAGACAGCAACGCAGTTAGTCTAAGAGTCAGTGAGAGACGCAGTAAGTCACGAAGCTAGACAGCAACGCAGTTAGTCACGAAGCAAGACAGTTACGCAGTAAGAGACGAAGCAAGAAAGTCACGCAGTGAGTCACGAAGCAAGTGAGATACGCAGACAGTTACGAAGTCAGTAAGAAACGCAGCTTTCCATTTTGACTTTCAGTCGATGAGACGTAGTG', 'TATATGAACCGTATTAACGAACTAACGGGGCGGTTGATACTAACAATCGAGAGAGTACTAAGGCCTCCTTATGGACTATAAATCCGTGAACCATTTTGACTTTCAGTCGATGAGACGTAGCA', 'TATATGAACGATATTAACGTACTAACGGGGCGGTTGATACTAACAATCGAGAGAGTACTATAACTCGGATGCGAACTATAAATCCGTGAACCATTTTGACTTTCAGTCGATGAGACGTAGCA', 'AGTATGAACGTTATTAACGCGTATATTAGTGAGAAAGACACGCAGACAGCAACAAAGTCAGAGAGACACGCAGCAAGTGACAAAGTCAGCAAGTTACGCAGTAAGAGACAAAGTCAGTTAGTGACGCAGCAAGCTACAAAGTAAGTCAGCTACGCAGAAAGAGACAAAGTTAGTTAGAAACGCAGTGAGTCACAAAGTAAGCAAGTTACGCAGCAAGCAACAAAGTTAGACAGTTACGCAGTGAGAGACAAAGTGAGAAAGACACGCAGACAGCAACAAAGTCAGAGAGACACGCAGCAAGTGATTTTGACTTTCAGTCGATGAGACGTAGCA',
           'AGTATGAACGCTATTAACGGGTATATTAGTAAGTCAGCTACGCAGAAAGAGACAAAGTCAGAGAGACACGCAGCAAGTGACAAAGTAAGCAAGTTACGCAGCAAGCAACAAAGTCAGTTAGTGACGCAGCAAGCTACAAAGTGAGAAAGACACGCAGACAGCAACAAAGTTAGTTAGAAACGCAGTGAGTCACAAAGTCAGCAAGTTACGCAGTAAGAGACAAAGTTAGACAGTTACGCAGTGAGAGACAAAGTAAGTCAGCTACGCAGAAAGAGACAAAGTCAGAGAGACACGCAGCAAGTGATTTTGACTTTCAGTCGATGAGACGTAGCA', 'ACTATGAACGGTATTAAGTAAGAGGTATAGTAGCAAGTGAGTCACGCAGTCAGAGACGAAGTCAGATAGCAACGCAGCTTCATAGAGAGCTAGACACGCAGTGAGTAACGAAGAGAGCTAGACACGCAGTGAGTAACGAAGAAACGAAGAAACGAAGAAACGAAGCAACGTAGTTAGCAACGCAGATAGAGTCGAACGTAGTCAGACACGCAGTGAGATACGAAGAGAGATTTCCATTTTGACTTTCAGTCGATGAGACGTAGTA', 'AGTATGAAGTAATATTAAGTATGTATATTAGTCAGCAAGCAACGCAGTAAGTAACAAAGTTAGACAGTTACGCAGTGAGAGACAAAGTCAGTGAGATACGCAGTTAGCTACAAAGTTAGTTAGAAACGCAGTGAGTCACAAAGTGAGTTAGTAACGCAGTTAGATACAAAGTTAGCTAGATACGCAGCAAGATACAAAGTGAGCAAGCAACGCAGACAGACACAAAGTTAGTGAGTTACGCAGATAGAGACAAAGTCAGCAAGCAACGCAGTAAGTAACAAAGTTAGACAGTTACGCAGTGAGAGATTTTGACTTTCAGTCGATGAGACGTAGCA', 'ACTATGAAGTATTATTAAGTACGTATTGGTAGTAGCAAGTGAGATACGCAGACAGTTACGAAGTCAGTAAGAAACGCAGCTTGATAGAGACGTAGATAGAAACGCAGCAAGTGACGAAGTTACGCAGAGAGCAACGTAGACAGACTCGAACGTAGTTAGTAACGCAGTGAGATACGTAGACAGTGACGCAGAAAGCTTAGAAGTGAGCAAGCAACGCAGACAGATACGAAGTCAGAAAGCAACGCAGTTTCGAAGTCAGTTACGCAGACAGACACGAAGAGAGACACGCAGACAGCTTTATAGCAAGTCAGACACGCAGAGAGCTACGAAGTCAGTAAGAAACGCAGTCAGTCACGAAGCAAGTGAGATACGCAGACAGTTACGAAGTCAGTAAGAAACGCAGCTTTCCATTTTGACTTTCAGTCGATGAGACGTAGCA', 'ACTATGAAGTACTATTAAGTAGGTATAGGTAGTAGCAAGACAGATACGCAGCTAGACACGAAGTTAGCTAGATACGCAGCAAGATTCGAAGTCAGACACGCAGTGAGATACGTAGAGAGATTGATACGCAGTGAGTTACGTAGATAGACACGCAGATAGCTACGCAGTGAGTGACGTAGACAGTAACGCAGTTAGCATCAGAGAAACGTAGAGACGCAGAAAGTTACGAAGAAACGTAGTCACGCAGAAAGCTACGTACGCAGATAGACACGTAGCTACGCAGATAGACTCGAACGTAGCTAGTGACGCAGAAAGTGACGAAGTAAGCAACGCAGAAAGTCTTCCATTTTGACTTTCAGTCGATGAGACGTAGCA', 'AGTATGAAGTAGTATTAAGTTAGTATATAAGTCAGTGAGATACGCAGTTAGCTACAAAGTCAGAGAGACACGCAGCAAGTGACAAAGTCAGCAAGCAACGCAGTAAGTAACAAAGTCAGTTAGTGACGCAGCAAGCTACAAAGTGAGCAAGCAACGCAGACAGACACAAAGTCAGAAAGCAACGCAGTTACAAAGTGAGTTAGTAACGCAGTTAGATACAAAGTTAGCTAGATACGCAGCAAGATACAAAGTCAGTGAGATACGCAGTTAGCTACAAAGTCAGAGAGACACGCAGCAAGTGATTTTGACTTTCAGTCGATGAGACGTAGCA', 'AGTATGAAGTTATATTAAGTTTGTATATAAGTGAGTTAGTAACGCAGTTAGATACAAAGTTAGCTAGATACGCAGCAAGATACAAAGTGAGCAAGCAACGCAGACAGACACAAAGTCAGAAAGCAACGCAGTTACAAAGCAAGACAGATACGCAGCTAGACACAAAGTTAGCTAGATACGCAGCAAGATACAAAGTGAGCAAGCAACGCAGACAGACACAAAGTTAGTGAGTTACGCAGATAGAGACAAAGTGAGTTAGTAACGCAGTTAGATACAAAGTTAGCTAGATACGCAGCAAGATATTTTGACTTTCAGTCGATGAGACGTAGCA', 'ACTATGAAGTTTTATTAAGTTCGTACTGGTAGTAGACAGCTAGACACGCAGAGAGCTACGAAGACAGAGAGCTACGCAGTTAGATTCCAAGAATCATAGCAAGTGACGCAGTGAGACACGAAGCAAGTGACGCAGTGAGACACGAAGAAACGAAGAAACGAAGAAACGAAGTAAGAGACGCAGTAAGTTACGAAGATAGATAGTCACGCAGACTCGAAGACAGTCAGCTACGCAGCTAGTAACGAAGATAGACAGAGTAATAGCAAGTGACGCAGTGAGACACGAAGCAAGTGACGCAGTGAGACACGAAGAAACGAAGAAACGAAGAAACGAAGTGAGACAGACACGAAGTAAGAGAGTTACGCAGACAGTTTCCAAGAATCATAGCAAGTGACGCAGTAACGAAGCAAGTGACGCAGTAACGAAGAAACGAAGAAACGAAGAAACGAAGACACGCAGATACGTAGTCAGTGACGCAGTGAGATTCGAACGTAGTAAGAAAGTGACGTAGATAGTTAGCTACGCAGCAAGCTTAATAGCAAGTGACGCAGAGAGTTACGAAGCAAGTGACGCAGAGAGTTACGAAGAAACGAAGAAACGAAGAAACGAAGACAGCTAGACACGCAGAGAGCTACGAAGACAGAGAGCTACGCAGTTAGATTTCCATTTTGACTTTCAGTCGATGAGACGTAGCT', 'ACTATGAAGTTCTATTAAGTTGGTATGTGTAGTAGTCAGCTAGAAACGCAGAGAGACACGAAGTTAGACAGTCACGCAGTCAGTCTCGAAGCTAGTGACGCAGCAAGCTACGAAGTAAGCAACGCAGTAAGTGACGAAGCTAGTGACGCAGAAAGTGACGTAGTAAGCAACGCAGAAAGTCTCATAGAGAGCTAGATACGCAGCTACGAAGAGAGCTAGATACGCAGCTACGAAGAAACGAAGAAACGAAGAAACGTAGATAGTTACGCAGCTAGACACGTAGATAGAAAGACACGCAGATAGCATACAAGATAGATAGTCACGCAGTCAGCTTCATAGAGAGCTAGATACGCAGACAGACACGAAGAGAGCTAGATACGCAGACAGACACGAAGAAACGAAGAAACGAAGAAACGTAGATAGACACGCAGCTAGACACGAAGTCAGATACGCAGTGAGTATCGAAGTCAGCTAGTGACGAAGACAGCAACGCAGTAAGCATTCCATTTTGACTTTCAGTCGATGAGACGTAGTA', 'AGTATGAAGTTGTATTAAGTCAGAGGTGAGTCAGCAAGTGACGCAGTCAGACACAAAGTTAGACAGTCACGCAGCTAGTAACAAAGTCAGCTAGAAACGCAGAGAGACACAAAGTTAGACAGTCACGCAGTCAGTCACAAAGTCAGCAAGCAACGCAGTAAGTAACAAAGTTAGACAGTTACGCAGTGAGAGACAAAGTCAGCAAGTGACGCAGTCAGACACAAAGTTAGACAGTCACGCAGCTAGTAATTTTGACTTTCAGTCGATGAGACGTAGTA', 'AATATGAAGTCATATTAAGTCTACTATAAGAGTTAGAGAGACTAAGTTTAATATGCGAACTAACCCTGAATTATGGATTTTGACTTTCAGTCGATGAGACGTAGAG', 'ACTATGAAGTCTTATTAAGTCCGTACACGTAGTAGCAAGCAAGAGACGCAGTAAGCAACGAAGTAAGCTAGTGACGCAGAGAGATTACAAGTAAGTAAGAGACGCAGTCAGATTCATAGACAGAGACGCAGCTAGACACGAAGACAGAGACGCAGCTAGACACGAAGAAACGAAGAAACGAAGAAACGTAGACAGAGACGCAGCTAGACACGAAGACAGAGACGCAGCTAGATTCCAAGAATCATAGACAGAGACGCAGCTAGACACGAAGACAGAGACGCAGCTAGACACGAAGAAACGAAGAAACGAAGAAACGAAGACAGAGACGCAGCTAGACACGAAGACAGAGACGCAGCTAGACTACAAGCAAGCAAGTTACGCAGACAGCTTCAGACGCAGAAAGTCACGTAGAGACGAACGCAGATAGATACGTAGTCACGAACGCAGATAGATACGTAGCAACGCAGCTAGTTTTATAGCAAGCAAGTTACGCAGTAACGAAGTTAGATAGTCACGCAGTTAGATACGAAGCAAGCAAGAGACGCAGTAAGCAACGAAGTAAGCTAGTGACGCAGAGAGATTTCCATTTTGACTCTCAGTCGATGAGACGTAGATAGAA', 'ACTATGAAGTCCTATTTATTGTATTTATAGTAGCAAGTCAGCTACGCAGAGAGTAACGAAGTAAGACAGTAACGCAGCAAGAGTCATAGAGAGCTAGATACGCAGAAAGTTACGAAGAGAGCTAGATACGCAGAAAGTTACGAAGAAACGAAGAAACGAAGAAACGTAGTCAGACACGCAGATAGACACGTAGATAGACAGAGACGCAGTGAGATTAAGAGTGAGTTAGCAACGAAGAGAGATAGACACGCAGAGAGACACGAAGTCAGCAAGTCACGCAGTAAGTGACGAAGAGAGTAAGAGACGAAGTCAGAAAGTAACGCAGTTAGTAACGAAGTAAGACAGTAACGCAGTTAGCATTCCATTTTGACTTTCAGTCGATGAGACGTAGTG']
    print(generate_svg(seq))


